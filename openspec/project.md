# Project Context

## Purpose

This project (`litefront`) is a specialized frontend application designed for banking and business administration tasks (e.g., payment documents, business partners, reference books). It utilizes a modular architecture to handle complex forms, data tables, and secure authentication.

## Tech Stack

- **Core:** React 19, TypeScript 5.x, Vite 6.x.
- **Architecture:** Feature-Sliced Design (FSD) (implied by folder structure and alias configuration).
- **Routing:** TanStack Router (File-based, type-safe routing).
- **State Management:**
  - **Server State:** TanStack Query v5 (React Query).
  - **Client State:** Zustand (Auth, User, Permissions) and MobX (Reference Books, UI state).
- **Styling:** Mantine v8 (UI Kit), CSS Modules (SCSS) for custom styles.
- **UI Libraries:**
  - **Components:** `@mantine/core`, `@mantine/dates`, `@mantine/notifications`.
  - **Tables:** `mantine-react-table`.
  - **Icons:** `@tabler/icons-react`, `react-icons`.
- **Internationalization:** i18next (React-i18next, Backend loader).
- **Tooling:** ESLint, Prettier, Stylelint, Husky, Ladle (Storybook alternative).
- **Testing:** Vitest (Unit), Playwright (E2E).

## Project Conventions

### Code Style & Quality Assurance

- **Linter & Formatter:** The project uses **ESLint** (with Mantine config), **Prettier**, and **Stylelint** (for SCSS).
- **Strict Typing:** TypeScript is used extensively.
- **Pre-commit Hooks:** **Husky** and **Lint-staged** ensure quality before commits.
- **Mandatory Verification:** All code changes must pass the strict verification script: `npm run check`.
  - This script aggregates **Stylelint**, **TypeScript compilation**, and **ESLint**.
- **Env Consistency:** A custom Vite plugin (`vite-dotenv-checker`) ensures `.env` and `.env.example` are consistent. Missing variables will fail the build (except in production).

### Design & UX Standards

- **Visual Style:** Professional, data-dense interface suitable for banking operations.
  - **Theming:** Controlled via `@mantine/core` theme object (`theme.ts`) and CSS variables.
  - **Modes:** Full support for Light and Dark modes (`ThemeSwitcher`, `useMantineColorScheme`).
- **Typography & Hierarchy:**
  - **Font:** `Roboto` and `Inter` via CSS/Mantine theme.
  - **Layout:** Heavy usage of Flexbox and Grid via Mantine's `Group`, `Stack`, and `Flex` components.
- **Interactivity:**
  - **Tables:** Advanced data tables (`MainTable`) with sorting, filtering, and infinite scrolling.
  - **Modals:** Extensive use of Modals for editing and details (e.g., `BusinessPartnerInfoModal`, `CalendarEditModal`).
- **Feedback & States:**
  - **Notifications:** `@mantine/notifications` used for success/error feedback.
  - **Loading:** Custom `MainLoader` component and loading overlays.

### Architecture Patterns (Feature-Sliced Design)

The project follows a structure inspired by **Feature-Sliced Design (FSD)**, facilitated by TypeScript path aliases:
- **Layers:**
  1. `src/app/` - Global setup (i18n, plugins).
  2. `src/pages/` - Page components composed of widgets/features.
  3. `src/widgets/` - (Configured in TSConfig).
  4. `src/features/` - (Configured in TSConfig).
  5. `src/shared/` - Reusable code (API, Stores, Components, Hooks).
- **Dependency Rule:** Logic should flow from higher layers (Pages) to lower layers (Shared).

### Routing Strategy

- **File-Based Routing:** Routes are defined in `src/routes`.
- **Route Generation:**
  - **Important:** The route tree (`src/generated/routeTree.gen.ts`) is generated by TanStack Router.
  - **Action:** Changes to files in `src/routes` update the generated tree via the Vite plugin.
- **Conventions:**
  - `__root.tsx` defines the main layout (Header, Menu, Providers).
  - **Lazy Loading:** Routes use the `.lazy.tsx` suffix pattern (e.g., `index.lazy.tsx`) to enable code splitting.
  - **Flat Routes:** Use of `.` delimiters for nesting (e.g., `reference-book/calendar/index.lazy.tsx`).

### Data Fetching & API

- **Client:** The app uses **Axios** instances (`$host`, `$authHost`) configured in `src/shared/api/index.ts`.
- **Server State:** **TanStack Query** (`useQuery`, `useMutation`, `useInfiniteQuery`) wraps API calls for caching and state management.
- **Pattern:**
  - API functions are defined in `src/shared/api/mutation/`.
  - Interceptors handle Bearer token injection and global error handling (401/403 redirects).
- **Pagination:** Infinite scrolling is implemented for tables using `useInfiniteQuery`.

### Internationalization (I18n)

- **Tooling:** `i18next` ecosystem.
- **Workflow:**
  - Translations are loaded via HTTP backend from `/public/locales/`.
  - `i18next-parser` is configured (`i18next-parser.config.ts`) to extract keys from source code into JSON files.
  - Language detection order: navigator -> htmlTag -> path -> subdomain.

### Git Workflow

- **Branching:** Standard workflows.
- **Versioning:** `vite-plugin-version-mark` is used to tag builds with Git commit hashes.

## Domain Context

- **Authentication:**
  - Protocol: Custom JWT implementation (Access + Refresh Tokens).
  - Storage: Tokens stored in LocalStorage via **Zustand** persist middleware (`auth-storage`).
  - Logic: `AuthProvider` handles automatic token refreshing based on expiration time.
  - User Info: Decoded from JWT (`jwt-decode`) and stored in `userStore`.
- **Permissions:**
  - Role-Based Access Control (RBAC) implemented via `permissionStore`.
  - UI elements (Menu items, Buttons) check permissions (e.g., `hasReadPermission`, `hasCreatePermission`).
- **Core Entities:**
  - **Payment Documents:** Complex forms with validation (`react-hook-form`), creating instructions, and handling ISO20022 fields.
  - **Business Partners:** Directories of clients/accounts with synchronization capabilities (`IconSC360`).
  - **Reference Books:** Dictionaries (Currency, Calendar, Banks) managed via MobX or Query.

## Important Constraints

- **Environment Variables:**
  - Access variables via `import.meta.env.VITE_*`.
  - Variables must be defined in `.env` and matched in `.env.example`.
- **Build Consistency:** The build uses `node:lts-alpine` and `caddy:alpine` for a lightweight, performant container.
- **CSS Architecture:**
  - **SCSS Modules:** Used for component-specific styling (`*.module.scss`).
  - **Mantine Styles:** Base styles provided by Mantine, customized via `postcss-preset-mantine`.
- **No Circular Dependencies:** Strict layer separation is encouraged.

## External Dependencies

- **Backend API:** REST API (URL defined in `VITE_API_URL`).
- **SC-Bank.360:** External system for synchronizing business partners and accounts.
- **Docker:** Production builds are served via **Caddy** web server.
